@using PetClinicSystem.Models
@using Microsoft.AspNetCore.Http

@{
    // Role from session (0=Client, 1=Admin, 2=Staff)
    int role = Context.Session.GetInt32("UserRole") ?? -1;

    // Safe cast of pets list from ViewBag
    var pets = ViewBag.Pets as List<Pet> ?? new List<Pet>();
}

<div class="row">

    <!-- LEFT: CATEGORY MENU -->
    <div class="col-md-2">
        <div class="category-list card shadow-sm p-3">
            <h6 class="text-secondary mb-3">Categories</h6>

            <ul class="nav flex-column" id="categoryMenu">
                <!-- Filled by JS -->
            </ul>
        </div>
    </div>

    <!-- MIDDLE: SERVICE CARDS -->
    <div class="col-md-6">
        <div class="card shadow-sm p-3">
            <div class="d-flex justify-content-between align-items-center mb-2">
                <h6 class="fw-bold">Services</h6>
                <input type="text"
                       id="searchServices"
                       class="form-control w-50"
                       placeholder="Search services...">
            </div>

            <div id="serviceGrid" class="row g-3">
                <!-- Filled dynamically -->
            </div>
        </div>
    </div>

    <!-- RIGHT: CART - only visible/usable to Staff (role == 2) -->
    @if (role == 2)
    {
        <div class="col-md-4">
            <div class="card shadow p-3 rounded-4">
                <h5 class="fw-bold">Transaction Summary</h5>

                <!-- SELECT PET -->
                <label class="fw-semibold mt-2">Select Pet</label>
                <select id="petSelect" class="form-select mb-2">
                    <option value="">Choose pet...</option>
                    @foreach (var p in pets)
                    {
                        <option value="@p.PetId">@p.Name (@p.Owner?.FullName)</option>
                    }
                </select>

                <!-- HIDDEN STAFF ID -->
                <input type="hidden" id="staffId" value="@Context.Session.GetInt32("UserId")" />

                <hr />

                <!-- CART TABLE -->
                <table class="table table-sm">
                    <thead>
                        <tr>
                            <th>Item</th>
                            <th>₱</th>
                            <th>Qty</th>
                            <th>Total</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody id="cartTable"></tbody>
                </table>

                <hr />

                <!-- SUBTOTAL -->
                <div class="d-flex justify-content-between">
                    <span class="fw-semibold">Subtotal:</span>
                    <span id="subtotal">₱0.00</span>
                </div>

                <!-- PROCESS PAYMENT -->
                <button class="btn btn-success mt-3 w-100" type="button" onclick="checkoutPOS()">
                    <i class="fa-solid fa-cash-register me-2"></i> Process Payment
                </button>

            </div>
        </div>
    }
    else
    {
        <div class="col-md-4">
            <div class="card shadow p-3 rounded-4 text-center">
                <h5 class="fw-bold">Point of Sale</h5>
                <p class="text-muted mt-2">
                    POS cart is available for <strong>Staff</strong> only.
                </p>
                <p class="small text-secondary">
                    You can still view services on the left. To create transactions, please sign in as a staff account.
                </p>
                <div class="mt-3">
                    <button class="btn btn-outline-secondary" disabled>
                        Cart disabled for your role
                    </button>
                </div>
            </div>
        </div>
    }

</div>

<style>
    .category-list ul li {
        margin-bottom: 6px;
    }

    .category-item {
        padding: 10px;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 500;
        color: #0d6efd;
        transition: 0.2s;
    }

        .category-item:hover,
        .category-item.active {
            background: #e7f1ff;
            color: #0a58ca;
        }

    .service-card {
        padding: 15px;
        border-radius: 12px;
        border: 1px solid #e3e3e3;
        background: #ffffff;
        cursor: pointer;
        transition: 0.2s ease;
        text-align: center;
    }

        .service-card:hover {
            background: #e8f5ff;
            transform: translateY(-3px);
            border-color: #bcdfff;
        }

    .service-title {
        font-weight: 600;
        font-size: 14px;
        margin-bottom: 4px;
    }

    .service-price {
        font-size: 13px;
        color: #198754;
        font-weight: bold;
    }
</style>
